$schema: 1.0
name: current-user-sample
image: microsoftwindowsdesktop_windows-ent-cpc_win11-24H2-ent-cpc
tasks:

  - name: ~/powershell
    parameters:
      command: |
        $currentUser = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name
        Write-Output $currentUser
        $outDir = 'C:\provisioning\temp'
        if (-not (Test-Path $outDir)) { New-Item -Path $outDir -ItemType Directory -Force | Out-Null }
        $outFile = Join-Path $outDir 'system-intrinsic-user.txt'
        Set-Content -Path $outFile -Value $currentUser -Encoding UTF8

  - name: powershell
    parameters:
      command: |
        $currentUser = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name
        Write-Output $currentUser
        $outDir = 'C:\provisioning\temp'
        if (-not (Test-Path $outDir)) { New-Item -Path $outDir -ItemType Directory -Force | Out-Null }
        $outFile = Join-Path $outDir 'system-trusted-user.txt'
        Set-Content -Path $outFile -Value $currentUser -Encoding UTF8
userTasks:
  - name: ~/powershell
    parameters:
      command: |
        $currentUser = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name
        Write-Output ($currentUser + ' user task')
        $outDir = 'C:\provisioning\temp'
        if (-not (Test-Path $outDir)) { New-Item -Path $outDir -ItemType Directory -Force | Out-Null }
        $outFile = Join-Path $outDir 'standard-intrinsic-user.txt'
        Set-Content -Path $outFile -Value $currentUser -Encoding UTF8

  - name: powershell
    parameters:
      command: |
        $currentUser = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name
        Write-Output $currentUser
        $outDir = 'C:\provisioning\temp'
        if (-not (Test-Path $outDir)) { New-Item -Path $outDir -ItemType Directory -Force | Out-Null }
        $outFile = Join-Path $outDir 'standard-trusted-user.txt'
        Set-Content -Path $outFile -Value $currentUser -Encoding UTF8